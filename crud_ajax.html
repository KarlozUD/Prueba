<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crud Ajax API REST</title>
</head>
<body>
    <h1>CRUD AJAX API REST</h1>
    <section class="crud">
        <article>
            <h2 class="crud_title">Agregar Santo</h2>
            <form action="" class="crud_form">
                <input type="text" name="nombre" placeholder="nombre" required> <br>
                <input type="text" name="constelacion" placeholder="Constelación" required> <br>
                <input type="submit" value="enviar">
                <input type="hidden" name="id ">
            </form>
        </article>
        <article>
            <h2>Ver Santos</h2>
            <table class="crud_table">
                <thead>
                    <th>Nombre</th>
                    <th>Constelación</th>
                    <th>Acciones</th>
                </thead>
                <tbody></tbody>
            </table>
        </article>
    </section>
    <template class="crud_template">
        <tr>
            <td class="name"></td>
            <td class="constellation"></td>
            <td>
                <button class="edit">Editar</button>
                <button class="delete">Eliminar</button>
            </td>
        </tr>
    </template>
    <script>
        const d=document,
        $table= d.querySelector(".crud_table"),
        $title= d.querySelector(".crud_title"),
        $template= d.querySelector(".crud_template").content,
        $form =d.querySelector("crud_form"),
        $fragment=d.createDocumentFragment();

        const ajax = options=>{
           // console.log(options);
            let {url, method, success, error, data}= options;
            const xhr= new XMLHttpRequest();

            xhr.addEventListener("readystatechange", e=>{
                if(xhr.readyState!==4)return;
                if(xhr.status >= 200 && xhr.status < 300){
                    let json= JSON.parse(xhr.responseText);
                    success(json);
                }else{
                    let message = xhr.statusText || "Ocurrio un Error";
                    error(`error: ${xhr.status} ${message}`);
                }
            });
            xhr.open(method || "GET", url)
            xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
            xhr.send(JSON.stringify(data));
        }
            const getAll= ()=> {
                ajax({
                    //method: "GET",
                    url:"http://localhost:33/santos",
                    success:(res)=>{
                        console.log(res);
                        res.forEach(element => {
                            $template.querySelector(".name").textContent=element.nombre;
                            $template.querySelector(".constellation").textContent=element.constelacion;
                            $template.querySelector(".edit").dataset.id =element.id;
                            $template.querySelector(".edit").dataset.name =element.nombre;
                            $template.querySelector(".edit").dataset.constellation =element.constelacion;
                            $template.querySelector(".delete").dataset.id= element.id;

                            let $clone = d.importNode($template, true);
                            $fragment.appendChild($clone);
                        });
                        $table.querySelector("tbody").appendChild($fragment);
                    },
                    error: (err)=>{
                        console.log(err);
                    $table.insertAdjacentHTML("afterend", `<p><b>${err}</b></p>`)},
                    //data:null
                });
            }
            
      
        d.addEventListener("DOMContentLoaded", getAll);

    </script>
</body>
</html>